name: Test
# Sets the trigger to changing the VERSION file in the main branch
on:
  push:
    branches:
    - main
    paths:
    - 'VERSION'

jobs:
  test:
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [windows-2019, windows-2022, windows-2025]
    
    steps:
    - name: Sync Repo to the Server
      uses: actions/checkout@v1

    - name: Compile 64bit Binary
      run: |
        windres version.rc -o version.o
        gcc .\src\bin_grabber.c version.o -o .\output\bin_grabber_x64.exe -s -m64

    - name: Remove Placeholder
      run: Remove-Item output/.gitkeep

    - name: Test the Tool
      run: .\output\bin_grabber_x64.exe running_processes

    - name: Check Output
      run: Get-ChildItem running_processes
